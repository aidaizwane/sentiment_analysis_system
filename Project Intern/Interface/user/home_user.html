{% extends "base.html" %}

{% block title %}Client Sentiment Analysis{% endblock %}

{% block extra_css %}
<style>
.status-pill {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid #d1d5db;
  background: #e5e7eb;
  color: #374151;
  display: inline-flex;
  align-items: center;
}
.status-pill.complaint {
  background: #fee2e2;
  color: #b91c1c;
  border-color: #fecaca;
}
.status-pill.noncompliant {
  background: #ecfdf3;
  color: #166534;
  border-color: #bbf7d0;
}
</style>
{% endblock %}

{% block content %}

<h1 style="text-align:center; letter-spacing:0.18em;">
  CLIENT SENTIMENT ANALYSIS
</h1>

<div style="display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-top:32px;">

  <!-- Upload card (stays left as before) -->
  <div style="background:#fff; padding:24px; border-radius:14px; border:1px solid #e5e7eb;">
    <h3>Upload .wav files</h3>
    <p>Select one or multiple audio files.</p>

    <form id="analysisForm" data-loading="true" method="post" enctype="multipart/form-data">
      <input type="file" name="audio_files" multiple>
      <br><br>
      <button class="btn secondary" type="submit">Run Analysis</button>
    </form>
  </div>

  <!-- Latest Analysis (FORCED BELOW) -->
  <div style="background:#fff; padding:24px; border-radius:14px; border:1px solid #e5e7eb; grid-column: 1 / -1;">
    <h3>Latest Analysis</h3>
    <p>No analysis yet.</p>
  </div>

</div>

<script>
  function showLoadingOverlay() {
    const overlay = document.getElementById("loadingOverlay");
    if (!overlay) return;

    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden", "false");
  }

   document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("analysisForm");
    if (!form) {
      console.log("analysisForm not found");
      return;
    }

    form.addEventListener("submit", (e) => {
      // 1) show overlay first
      showLoadingOverlay();

      // 2) prevent immediate navigation so browser can render overlay/spinner
      e.preventDefault();

      // 3) submit after a tiny delay (gives UI time to paint)
      setTimeout(() => {
        form.submit();
      }, 50);
    });
  });
</script>

{% endblock %}
